<div id="minutes_field" data-controller="markdown-preview">
  <div class="flex justify-between items-center mb-2">
    <%= form.label :minutes, "AI議事録", class: "block text-sm font-medium leading-6 text-gray-900" %>
    
    <!-- Tabs -->
    <div class="flex space-x-1 rounded-lg bg-gray-100 p-0.5" role="tablist" aria-orientation="horizontal">
      <button type="button" 
              data-markdown-preview-target="writeBtn"
              data-action="click->markdown-preview#showWrite"
              class="flex items-center rounded-md py-1 px-3 text-xs font-semibold focus:outline-none transition-all"
              role="tab" 
              aria-selected="true">
        編集
      </button>
      <button type="button" 
              data-markdown-preview-target="previewBtn"
              data-action="click->markdown-preview#showPreview"
              class="flex items-center rounded-md py-1 px-3 text-xs font-semibold focus:outline-none transition-all"
              role="tab" 
              aria-selected="false">
        プレビュー
      </button>
    </div>
  </div>
  
  <div class="relative group">
    <!-- Editor -->
    <%= form.text_area :minutes, 
        rows: 15, 
        placeholder: "（録音終了後にAIが自動生成します）", 
        class: "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 bg-gray-50 font-mono", 
        data: { markdown_preview_target: "input" } %>

    <!-- Preview -->
    <div data-markdown-preview-target="preview" class="hidden min-h-[300px] w-full rounded-md border border-gray-200 bg-white p-4 prose prose-sm max-w-none overflow-y-auto shadow-sm">
      <!-- Content loaded via JS -->
    </div>
    
    <% if interaction.transcript.present? %>
       <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
           <button type="button" onclick="document.getElementById('ai-summarize-form').submit();" class="flex items-center gap-1 bg-white hover:bg-gray-100 text-gray-600 border border-gray-300 text-xs px-2 py-1 rounded shadow transition-all focus:outline-none" title="再生成する">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3">
                  <path fill-rule="evenodd" d="M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.919Z" clip-rule="evenodd" />
                </svg>
                再生成
           </button>
       </div>
    <% end %>
  </div>
  <p class="mt-1 text-xs text-gray-500 text-right">Markdown形式対応</p>
</div>
